<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Meta Pixel</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .test-btn { background-color: #007bff; color: white; }
        .success-btn { background-color: #28a745; color: white; }
        .error-btn { background-color: #dc3545; color: white; }
        #log { background-color: #f8f9fa; padding: 10px; border-radius: 5px; margin-top: 20px; max-height: 300px; overflow-y: auto; }
    </style>
    
    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '2238118589923921');
    fbq('track', 'PageView');
    </script>
    <!-- End Meta Pixel Code -->
</head>
<body>
    <h1>üîç Debug Meta Pixel</h1>
    <p>Esta p√°gina te ayudar√° a diagnosticar problemas con el Meta Pixel.</p>
    
    <div id="status"></div>
    
    <h2>Pruebas:</h2>
    <button class="test-btn" onclick="checkPixel()">üîç Verificar Pixel</button>
    <button class="test-btn" onclick="testPageView()">üìä Probar PageView</button>
    <button class="test-btn" onclick="testInitiateCheckout()">üõí Probar InitiateCheckout</button>
    <button class="test-btn" onclick="testPurchase()">üí∞ Probar Purchase</button>
    <button class="test-btn" onclick="clearLog()">üóëÔ∏è Limpiar Log</button>
    
    <h2>Log de Eventos:</h2>
    <div id="log"></div>
    
    <script>
        let logElement = document.getElementById('log');
        let statusElement = document.getElementById('status');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            logEntry.style.color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function updateStatus(message, type) {
            statusElement.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function checkPixel() {
            log('üîç Verificando Meta Pixel...');
            
            if (typeof window.fbq === 'undefined') {
                log('‚ùå ERROR: fbq no est√° definido', 'error');
                updateStatus('‚ùå Meta Pixel NO est√° cargado', 'error');
                return false;
            }
            
            if (typeof window.fbq !== 'function') {
                log('‚ùå ERROR: fbq no es una funci√≥n', 'error');
                updateStatus('‚ùå Meta Pixel NO est√° funcionando correctamente', 'error');
                return false;
            }
            
            log('‚úÖ fbq est√° disponible y es una funci√≥n', 'success');
            
            // Verificar si el pixel est√° inicializado
            if (window.fbq.loaded) {
                log('‚úÖ Meta Pixel est√° cargado correctamente', 'success');
                updateStatus('‚úÖ Meta Pixel est√° funcionando correctamente', 'success');
                return true;
            } else {
                log('‚ö†Ô∏è Meta Pixel est√° cargando...', 'warning');
                updateStatus('‚ö†Ô∏è Meta Pixel est√° cargando...', 'warning');
                return false;
            }
        }
        
        function testPageView() {
            log('üìä Enviando evento PageView...');
            if (window.fbq) {
                fbq('track', 'PageView');
                log('‚úÖ Evento PageView enviado', 'success');
            } else {
                log('‚ùå No se puede enviar PageView - fbq no disponible', 'error');
            }
        }
        
        function testInitiateCheckout() {
            log('üõí Enviando evento InitiateCheckout...');
            if (window.fbq) {
                fbq('track', 'InitiateCheckout', {
                    value: 17.00,
                    currency: 'USD',
                    content_name: 'Sistema Matem√°tico Premium',
                    content_category: 'ebook'
                });
                log('‚úÖ Evento InitiateCheckout enviado', 'success');
            } else {
                log('‚ùå No se puede enviar InitiateCheckout - fbq no disponible', 'error');
            }
        }
        
        function testPurchase() {
            log('üí∞ Enviando evento Purchase...');
            if (window.fbq) {
                fbq('track', 'Purchase', {
                    value: 17.00,
                    currency: 'USD',
                    content_name: 'Sistema Matem√°tico Premium',
                    content_category: 'ebook',
                    order_id: 'test-' + Date.now()
                });
                log('‚úÖ Evento Purchase enviado', 'success');
            } else {
                log('‚ùå No se puede enviar Purchase - fbq no disponible', 'error');
            }
        }
        
        function clearLog() {
            logElement.innerHTML = '';
            log('üóëÔ∏è Log limpiado');
        }
        
        // Verificaci√≥n autom√°tica al cargar
        window.addEventListener('load', function() {
            log('üöÄ P√°gina cargada, verificando Meta Pixel...');
            setTimeout(() => {
                checkPixel();
            }, 1000);
        });
        
        // Verificar cada 5 segundos si el pixel se carga
        let checkCount = 0;
        const checkInterval = setInterval(() => {
            checkCount++;
            if (checkCount > 10) {
                clearInterval(checkInterval);
                log('‚è∞ Tiempo de espera agotado', 'warning');
                return;
            }
            
            if (window.fbq && window.fbq.loaded) {
                clearInterval(checkInterval);
                log('‚úÖ Meta Pixel cargado despu√©s de ' + checkCount + ' intentos', 'success');
                updateStatus('‚úÖ Meta Pixel cargado correctamente', 'success');
            }
        }, 1000);
    </script>
    
    <!-- Meta Pixel Noscript Fallback -->
    <noscript>
        <img height="1" width="1" style="display:none"
        src="https://www.facebook.com/tr?id=2238118589923921&ev=PageView&noscript=1"
        />
    </noscript>
</body>
</html> 